.progress-bar-wrapper
  %table.table
    %thead
      %tr
        / %td
        %td{:class=> 'property-status property-status-inspection'} Inspection
        %td{:class=> 'property-status property-status-notification'} Notification
        %td{:class=> 'property-status property-status-hearing'} Hearing
        %td{:class=> 'property-status property-status-judgement'} Judgment
        %td{:class=> 'property-status property-status-resolution'}  Resolution
        %td{:style => "width: 20px"}

    / =kase.case_steps
    %tbody
      -if kase.events.empty? && kase.state == 'Open'
        %tr
          %td
            .progress-arrow.pending{:style => "z-index: 14"}
          %td
            .progress-arrow.pending{:style => "z-index: 13"}
          %td
            .progress-arrow.pending{:style => "z-index: 12"}
          %td
            .progress-arrow.pending{:style => "z-index: 11"}
          %td
            .progress-arrow.resolution.pending{:style => "z-index: 10"}
          %td
      -elsif kase.events.empty? && kase.state == 'Closed'
        %tr
          %td
            .progress-arrow.error{:style => "z-index: 14"}
          %td
            .progress-arrow.error{:style => "z-index: 13"}
          %td
            .progress-arrow.error{:style => "z-index: 12"}
          %td
            .progress-arrow.error{:style => "z-index: 11"}
          %td
            .progress-arrow.resolution.error{:style => "z-index: 10"}
          %td      
      -else
        %tr
          %td
            -if kase.events_by_step(:Inspection)# || kase.inspections.empty? 
              .progress-arrow.inspection{:class => "inspection-#{kase.case_number}", :style => "z-index: 14"}
            -else
              -if kase.missing_event?(:Inspection)
                .progress-arrow.error{:class => "inspection-#{kase.case_number}", :style => "z-index: 14"}
              -elsif kase.state != 'Open'
                .progress-arrow.error{:class => "inspection-#{kase.case_number}", :style => "z-index: 14"}
              -else
                .progress-arrow.pending{:class => "inspection-#{kase.case_number}", :style => "z-index: 14"}

          %td
            -if kase.events_by_step(:Notification)# || kase.notifications.empty?
              .progress-arrow.notification{:class => "notification-#{kase.case_number}", :style => "z-index: 13"}
            -else
              -if kase.missing_event?(:Notification)
                .progress-arrow.error{:class => "notification-#{kase.case_number}", :style => "z-index: 13"}
              -elsif kase.state != 'Open'
                .progress-arrow.error{:class => "notification-#{kase.case_number}", :style => "z-index: 13"}
              -else
                .progress-arrow.pending{:class => "notification-#{kase.case_number}", :style => "z-index: 13"}

          %td
            -if kase.events_by_step(:Hearing)
              -if kase.events_by_step(:Hearing).last.date > Time.now 
                .progress-arrow.pending{:class => "hearing-#{kase.case_number}", :style => "z-index: 12"}
              -else
                .progress-arrow.hearing{:class => "hearing-#{kase.case_number}", :style => "z-index: 12"}
            -else
              -if kase.missing_event?(:Hearing)
                .progress-arrow.error{:class => "hearing-#{kase.case_number}", :style => "z-index: 12"}
              -elsif kase.state != 'Open'
                .progress-arrow.error{:class => "hearing-#{kase.case_number}", :style => "z-index: 12"}
              -else
                .progress-arrow.pending{:class => "hearing-#{kase.case_number}", :style => "z-index: 12"}

          %td
            -if kase.events_by_step(:Judgment)
              .progress-arrow.judgement{:class => "judgement-#{kase.case_number}", :style => "z-index: 11"}
            -else
              -if kase.missing_event?(:Judgment)
                .progress-arrow.error{:class => "judgement-#{kase.case_number}", :style => "z-index: 11"}
              -elsif kase.state != 'Open'
                .progress-arrow.error{:class => "judgement-#{kase.case_number}", :style => "z-index: 11"}
              -else
                .progress-arrow.pending{:class => "judgement-#{kase.case_number}", :style => "z-index: 11"}

          %td
            -if kase.events_by_step(:Resolution)
              -if kase.events_by_name(:Resolution).first.date > Time.now
                .progress-arrow.resolution.loading{:class => "resolution-#{kase.case_number}", :style => "z-index: 10"}
              -else
                .progress-arrow.resolution{:class => "resolution-#{kase.case_number}", :style => "z-index: 10"}
            -else
              -if kase.missing_event?(:Resolution)
                .progress-arrow.resolution.error{:class => "resolution-#{kase.case_number}", :style => "z-index: 10"}
              -elsif kase.state != 'Open'
                .progress-arrow.resolution.error{:class => "resolution-#{kase.case_number}", :style => "z-index: 10"}
              -else
                .progress-arrow.resolution.pending{:class => "resolution-#{kase.case_number}", :style => "z-index: 10"}
          %td
        %hr.soften
  -if kase.data_error?
    %p{:style => "text-align: center; padding: 0 0 10px; margin:0 auto;"}
      %b{:style => "color: red"}
        Warning:
      This case is missing steps. 
      =link_to('#why-data-incomplete', "data-animation" => "true", :trigger => "hover", :delay => 100, "data-placement"=>"bottom", :rel=>"tooltip", "data-toggle"=>"modal", "data-title"=>"Receive notifications when the status of this property changes") do
        Why?


